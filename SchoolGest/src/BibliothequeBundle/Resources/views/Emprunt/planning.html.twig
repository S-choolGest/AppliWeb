{% extends "base_front.html.twig" %}
{% block css %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('bundles/adesignscalendar/css/fullcalendar/fullcalendar.css') }}" />
    <link rel="stylesheet" href="{{ asset('fullcalendar/core/main.css') }}">
    <link rel="stylesheet" href="{{ asset('fullcalendar/daygrid/main.css') }}">
    <link rel="stylesheet" href="{{ asset('fullcalendar/list/main.css') }}">
    <link rel="stylesheet" href="{{ asset('fullcalendar/timegrid/main.css') }}">
{% endblock %}
{% block nav %}
    <nav class="colorlib-nav" role="navigation">
        <div class="upper-menu">
            <div class="container">
                <div class="row">
                    <div class="col-xs-4">
                        <p>Le site idéal pour la gestion de votre école</p>
                    </div>
                    <div class="col-xs-6 col-md-push-2 text-right">
                        <p class="btn-apply"><a href="#">Notre Vision</a> <a href="#">Notre Missions</a>
                            {% if is_granted("IS_AUTHENTICATED_REMEMBERED") %}
                                {{ app.user.username }} |
                                <a href="{{ path('fos_user_security_logout') }}">
                                    {{ 'se déconnecter'|trans({}, 'FOSUserBundle') }}
                                </a>
                            {% else %}
                                <a href="{{ path('fos_user_security_login') }}">{{ 'se connecter'|trans({}, 'FOSUserBundle') }}</a>
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="top-menu">
            <div class="container">
                <div class="row">
                    <div class="col-md-2">
                        <div id="colorlib-logo"><a href="#">Edutech</a></div>
                    </div>
                    <div class="col-md-10 text-right menu-1">
                        <ul>
                            <li><a href="#">Accueil</a></li>
                            <li class="has-dropdown active">
                                <a href="#">Bibliothèque</a>
                                <ul class="dropdown">
                                    <li><a href="{{ path('catalogue_livre_front') }}">Catalogue</a></li>
                                    <li><a href="{{ path('biblio_emprunt_front') }}">Emprunts</a></li>
                                    <li><a href="{{ path('biblio_reservation_front') }}">Planning</a></li>
                                </ul>
                            </li>
                            <li><a href="#">Encardrement</a></li>
                            <li class="has-dropdown">
                                <a href="#">Cours</a>
                                <ul class="dropdown">
                                    <li><a href="#">Cours</a></li>
                                    <li><a href="#">Notes</a></li>
                                    <li><a href="#">Emploi de temps</a></li>
                                </ul>
                            </li>
                            <li><a href="#">Evènements</a></li>
                            <li class="btn-cta"><a href="#"><span>Get started</span></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

{% endblock %}
{% block aside %}
    <aside id="colorlib-hero">
        <div class="flexslider">
            <ul class="slides">
                <li style="background-image: url({{ asset('front/images/bibliotheque_cover.jpg') }});">
                    <div class="overlay"></div>
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-6 col-sm-12 col-md-offset-3 col-xs-12 slider-text">
                                <div class="slider-text-inner text-center">
                                    <h1>Planning</h1>
                                    <h2 class="breadcrumbs"><span><a href="#">Acceuil</a></span> | <span>PLanning</span>
                                    </h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </aside>
{% endblock %}
{% block container %}
    <div class="colorlib-classes">
        <div class="container">
            <div id="calendrier"></div>
        <!--{% include '@ADesignsCalendar/calendar.html.twig' %}-->
        </div>
    </div>
{% endblock %}
{% block js %}
    <!-- jQuery -->
    <script src="{{ asset('front/js/jquery.min.js') }}"></script>
    <!-- jQuery Easing -->
    <script src="{{ asset('front/js/jquery.easing.1.3.js') }}"></script>
    <!-- Bootstrap -->
    <script src="{{ asset('front/js/bootstrap.min.js') }}"></script>
    <!-- Waypoints -->
    <script src="{{ asset('front/js/jquery.waypoints.min.js') }}"></script>
    <!-- Stellar Parallax -->
    <script src="{{ asset('front/js/jquery.stellar.min.js') }}"></script>
    <!-- Flexslider -->
    <script src="{{ asset('front/js/jquery.flexslider-min.js') }}"></script>
    <!-- Owl carousel -->
    <script src="{{ asset('front/js/owl.carousel.min.js') }}"></script>
    <!-- Magnific Popup -->
    <script src="{{ asset('front/js/jquery.magnific-popup.min.js') }}"></script>
    <script src="{{ asset('front/js/magnific-popup-options.js') }}"></script>
    <!-- Counters -->
    <script src="{{ asset('front/js/jquery.countTo.js') }}"></script>
    <!-- Main -->
    <script src="{{ asset('front/js/main.js') }}"></script>

    <script src="{{ asset('bundles/fosjsrouting/js/router.min.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', { callback: 'fos.Router.setData' }) }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/adesignscalendar/js/fullcalendar/jquery.fullcalendar.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/adesignscalendar/js/calendar-settings.js') }}"></script>

    <!--Fichiers JS calendrier-->
    <script src="{{ asset('fullcalendar/core/main.js') }}"></script>
    <script src="{{ asset('fullcalendar/daygrid/main.js') }}"></script>
    <script src="{{ asset('fullcalendar/list/main.js') }}"></script>
    <script src="{{ asset('fullcalendar/interaction/main.js') }}"></script>
    <script src="{{ asset('fullcalendar/timegrid/main.js') }}"></script>
    <!--<script src="{{ asset('calendrier.js') }}"></script>-->
    <script>
        let evenements = "[";
        url = "{{ path('Mview_emprunts', {"iduser" : 'iduser'}) }}";
        url = url.replace("iduser", {{ app.user.id }});
        $.ajax({
            url: url,
            type: "POST",
            async: true,
            success: function (data) {
                console.log(data.emprunts)

                data.emprunts.forEach(e=>{
                    let evenement = [{
                        "title": "",
                        "start":"",
                        'end':"",
                        "backgroundColor": ""
                    }]
                    if(e.etat == 0){
                        evenement[0].title = "emprunt en attente : "+e.idlivre.titre
                        evenement[0].backgroundColor = "#8090B5"
                        evenement[0].start = e.dateemprunt.date
                        evenement[0].end = e.dateemprunt.date
                    }
                    else if (e.etat == 1){
                        evenement[0].title = "emprunt confirmé : "+e.idlivre.titre
                        evenement[0].backgroundColor = "#0082FF"
                        evenement[0].start = e.datedebut.date
                        evenement[0].end = e.datefin.date
                    }
                    else if (e.etat == 2){
                        evenement[0].title = "emprunt rendu : "+e.idlivre.titre
                        evenement[0].backgroundColor = "#008000"
                        evenement[0].start = e.dateconfirmation.date
                        evenement[0].end = e.dateconfirmation.date
                    }
                    else if (e.etat == 3){
                        evenement[0].title = "emprunt refusé : "+e.idlivre.titre
                        evenement[0].backgroundColor = "#FF0000"
                        evenement[0].start = e.daterendu.date
                        evenement[0].end = e.daterendu.date
                    }
                    url_event = "{{ path('emprunt_front', {"id" : 'id'}) }}";
                    url_event = url_event.replace("id", e.id);

                    evenements+="{\"title\":\""+evenement[0].title+"\", \"start\":\""+evenement[0].start+"\", \"end\":\""+evenement[0].end+"\", \"backgroundColor\":\""+evenement[0].backgroundColor+"\", \"url\":\""+url_event+"\"},"

                })
                let evenement = [{
                    "title": "",
                    "start": "",
                    "end": "",
                    "backgroundColor": ""
                },{
                    "title": "Live coding - Demo 2",
                    "start": "2019-11-23 14:00:00",
                    "end": "2019-11-23 16:00:00"
                }]
                evenements+="{\"title\":\""+evenement[0].title+"\", \"start\":\""+evenement[0].start+"\", \"end\":\""+evenement[0].end+"\", \"backgroundColor\":\""+evenement[0].backgroundColor+"\"}"
                evenements+="]"
                let events = JSON.parse(evenements);
                console.log(events)
                //evenements = JSON.parse(data.emprunts)
                // On va chercher la div dans le HTML
                let calendarEl = document.getElementById('calendrier');

                // On instancie le calendrier
                let calendrier = new FullCalendar.Calendar(calendarEl, {
                    // On appelle les composants
                    plugins: ['dayGrid','timeGrid','list'],
                    locale: 'fr',
                    header: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,list'
                    },
                    buttonText: {
                        today: 'Aujourd\'hui',
                        month: 'Mois',
                        week: 'Semaine',
                        list: 'Liste'
                    },
                    events: events,
                    nowIndicator: true,
                    editable: true,
                    eventDrop: (infos) => {
                        if(!confirm("Etes vous sûr.e de vouloir déplacer cet évènement")){
                            infos.revert();
                        }
                    },
                    eventResize: (infos) => {
                        console.log(infos.event.end)
                    }
                })

                // On affiche le calendrier
                calendrier.render();
            },
        });
        /*let evenements = [{
            "title": "Live coding - Demo",
            "start": "2020-11-23 09:00:00",
            "end": "2020-11-23 11:00:00",
            "backgroundColor": "#839c49"
        },{
            "title": "Live coding - Demo 2",
            "start": "2019-11-23 14:00:00",
            "end": "2019-11-23 16:00:00"
        }]*/

        window.onload = () => {

        }
    </script>
{% endblock %}